<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notebooq - Notes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
        }
        .card {
            word-wrap: break-word;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="d-flex justify-content-between mb-3">
        <h2>NotebooQ</h2>
        <div>
            <button id="profileBtn" class="btn btn-info me-2">Profile</button>
            <button id="logoutBtn" class="btn btn-danger">Logout</button>
        </div>
    </div>



    <!-- Add Note -->
    <div class="mb-4">
        <input type="text" id="noteTitle" class="form-control mb-2" placeholder="Title">
        <textarea id="noteContent" class="form-control mb-2" placeholder="Write your note..."></textarea>
        <button id="addNoteBtn" class="btn btn-primary mt-2">Add Note</button>
    </div>

    <!-- Notes Grid -->
    <div class="row" id="notesList"></div>
</div>

<script>
    const token = localStorage.getItem('token');
    if (!token) window.location.href = '/login.html';

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', () => {
        localStorage.removeItem('token');
        window.location.href = '/login.html';
    });

    // Profile
    document.getElementById('profileBtn').addEventListener('click', () => {
        window.location.href = '/profile.html';
    });

    // RTL/LTR for textarea while typing
    const noteContent = document.getElementById('noteContent');
    noteContent.addEventListener('input', () => {
        const text = noteContent.value;
        if (/[\u0600-\u06FF]/.test(text)) {
            noteContent.style.direction = 'rtl';
            noteContent.style.textAlign = 'right';
        } else {
            noteContent.style.direction = 'ltr';
            noteContent.style.textAlign = 'left';
        }
    });

    const noteTitle = document.getElementById('noteTitle');
    noteTitle.addEventListener('input', () => {
        const text = noteTitle.value;
        if (/[\u0600-\u06FF]/.test(text)) {
            noteTitle.style.direction = 'rtl';
            noteTitle.style.textAlign = 'right';
        } else {
            noteTitle.style.direction = 'ltr';
            noteTitle.style.textAlign = 'left';
        }
    });


    // Load Notes
    async function loadNotes() {
        const res = await fetch('/api/notes', {
            headers: { 'Authorization': 'Bearer ' + token }
        });
        const notes = await res.json();
        const list = document.getElementById('notesList');
        list.innerHTML = '';
        notes.forEach(n => {
            const card = document.createElement('div');
            card.className = 'col-md-4 mb-3 d-flex';
            const direction = /[\u0600-\u06FF]/.test(n.content) ? 'rtl' : 'ltr';
            card.innerHTML = `
            <div class="card p-3 shadow-sm flex-fill" style="direction: ${direction}; text-align: ${direction === 'rtl' ? 'right' : 'left'}; min-height: 150px;">
                <h5>${n.title}</h5>
                <p>${n.content.replace(/\n/g, '<br>')}</p>
            </div>`;
            list.appendChild(card);
        });
    }

    // Add Note
    document.getElementById('addNoteBtn').addEventListener('click', async () => {
        const title = document.getElementById('noteTitle').value.trim();
        const content = noteContent.value.trim();
        if (!title || !content) return alert('Title and content required');

        const res = await fetch('/api/notes', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({ title, content })
        });
        if (res.ok) {
            document.getElementById('noteTitle').value = '';
            noteContent.value = '';
            noteContent.style.direction = 'ltr';
            noteContent.style.textAlign = 'left';
            loadNotes();
        } else {
            alert('Failed to add note');
        }
    });

    loadNotes();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
